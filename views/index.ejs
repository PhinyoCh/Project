<%- include('./sidebar.ejs')  -%> 

    <main class="mt-5 pt-3 ">
      <div class="container-fluid">
          <div class="row">
            <div class="card">
              <div class="card-header bg-dark">
                <h3 class="text-uppercase text-center text-white mt-4">sound control</h3>
              </div>

              <div class="card-body">
                <div class="table-responsive">
                  <table id="table-room-id" class="table" style="width: 100%">
                    <thead>                     
                      <tr>
                        <th class="text-center">NUMBER</th>
                        <th class="text-center">ROOM NUMBER</th>
                        <th class="text-center">ROOM NAME</th>
                        <th class="text-center">FLOOR</th>
                        <th class="text-center">STATUS</th>
                        <th class="text-center">ACTION</th>
                        <th class="text-center">OPERACTION</th>
                      </tr>
                    </thead>
                    <tbody>
                      <div class="text-end">
                        <button class=" btn btn-success" id="allon-switch">All On</button>
                        <button class=" btn btn-danger" id="alloff-switch">All Off</button>
                        <button type="submit" data-bs-toggle="modal" data-bs-target="#add-modal" class="btn btn-primary"><i class="bi bi-plus-square"></i>ADD</button> 
                      </div>
                    </tbody> 
                  </table>
                </div>
              </div>
            </div>
          </div>
      </div>

      <!-- Modal ADD Button -->
      <div class="modal fade" id="add-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Add Room</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form class="needs-validation" novalidate>
              <div class="modal-body">
                <div class="form">
                  <div class="row">
                    <div class="col-md-12 mb-3">
                      <label for="room-name" class="form-label"> Room Name </label>
                      <input type="text" class="form-control" id="input-roomname" required >
                      <div class="invalid-feedback">
                        Please Enter Room Name.
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="room-number" class="form-label"> Room Number </label>
                      <input type="text" class="form-control" id="input-roomnumber" required>
                      <div class="invalid-feedback">
                        Please Enter Room Number.
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="room-name" class="form-label"> Floor </label>
                      <select class="form-select" style="margin-top: 7px;margin-bottom: 7px;padding-top: 9px;padding-bottom: 9px;" id="input-floor" required>
                        <option selected disabled value="">Select Floor...</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                      </select>
                      <div class="invalid-feedback">
                        Please select a floor.
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12 mb-3">
                      <label for="room-macaddress" class="form-label"> Mac Address </label>
                      <input type="text" class="form-control" id="input-macaddress" required>
                      <div class="invalid-feedback">
                        Please Enter Mac Address.
                      </div>
                    </div>
                  </div>
                </div>
              </div>  
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit-addroom" class="btn btn-primary">Submit</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal Edit Button -->
      <div class="modal fade" id="edit-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Edit Room</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form class="needs-validation" novalidate>
              <div class="modal-body">
                <div class="form">
                  <div class="row">
                    <div class="col-md-12 mb-3">
                      <label for="room-name" class="form-label"> Room Name </label>
                      <input type="text" class="form-control" id="input-editroomname" required >
                      <div class="invalid-feedback">
                        Please Enter Room Name.
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="room-number" class="form-label"> Room Number </label>
                      <input type="text" class="form-control" id="input-editroomnumber" required>
                      <div class="invalid-feedback">
                        Please Enter Room Number.
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="room-name" class="form-label"> Floor </label>
                      <select class="form-select" style="margin-top: 7px;margin-bottom: 7px;padding-top: 9px;padding-bottom: 9px;" id="input-editfloor" required>
                        <option selected disabled value="">Select Floor...</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                      </select>
                      <div class="invalid-feedback">
                        Please select a floor.
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12 mb-3">
                      <label for="room-macaddress" class="form-label"> Mac Address </label>
                      <input type="text" class="form-control" id="input-macaddress" required>
                      <div class="invalid-feedback">
                        Please Enter Mac Address.
                      </div>
                    </div>
                  </div>
                </div>
              </div>  
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit-editroom" class="btn btn-primary">Submit</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <br>
      <div class="container col-md-3 border-center">
        <select class="form-select" aria-label="Default select example">
           <option selected>Time Menu</option>
           <option value="1">Day</option>
           <option value="2">Week</option>
           <option value="3">Month</option>
        </select>
      </div>
      <div class="text-center mt-3 ">
        <button type="submit" name="edit" class="btn btn-warning"><span class="btn-label"><i class="bi bi-music-player"></i></span>MP3</button>
        <button type="submit" name="delete" class="btn btn-danger"><span class="btn-label"><i class="bi bi-broadcast-pin"></i></span>LIVE</button>
        <button type="submit" name="select" class="btn btn-secondary">SELECT</button>
    </div>   
    </main>
  </body>
</html>




<script src="/public/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
<script src="/public/js/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>

<script>
  var Feature = (function(){
      var dataTable = $('#table-room-id').DataTable({
        language : {emptyTable: "ไม่พบข้อมูล"},
        ordering: false,
        searching: false,
        lengthChange: false,
        paging: false,
        bAutoWidth: false,
        info: false,
        columns: [
          { 
            data: function (data) {
              return data['room_id'];                  // ข้อมูล ' ลำดับ '
            },
            className : 'text-center',              // จัดให้ข้อมูลอยู่ตรงกลาง
          },
          { 
            data: function (data) {
              return data['room_number'];                  // ข้อมูล ' ลำดับ '
            },
            className : 'text-center',              // จัดให้ข้อมูลอยู่ตรงกลาง
          },
          { 
            data: function (data) {
              return data['room_name'];                  // ข้อมูล ' ลำดับ '
            },
            className : 'text-center',              // จัดให้ข้อมูลอยู่ตรงกลาง
          },
          { 
            data: function (data) {
              return data['floor'];                  // ข้อมูล ' ลำดับ '
            },
            className : 'text-center',              // จัดให้ข้อมูลอยู่ตรงกลาง
          },
          { 
            data: function (data) {
              var status = ""
              if(data['status'] == 0){
                status = '<span class="btn btn-danger">Failure</span>';
              } else {
                status = '<span class="btn btn-success">Active</span>'
              }
              return status;                  // ข้อมูล ' ลำดับ '
            },
            className : 'text-center',              // จัดให้ข้อมูลอยู่ตรงกลาง
          },
          { 
            data: function (data) {
              return '<div class="form-switch" id="swform">\
                     <input class="form-check-input" type="checkbox" value="1" id="switch-box">\
                     </div>';               
            },
            className : 'text-center align-middle',              // จัดให้ข้อมูลอยู่ตรงกลาง
          },
          { 
            data: function (data) {
              return '<button type="submit" data-bs-toggle="modal" data-bs-target="#edit-modal" name="edit" class="btn btn-primary"\
                data-room_id="' + data['room_id'] + '" data-room_name="' + data['room_name'] + '" data-room_number="' + data['room_number'] + '"\
                data-mac_address="' + data['mac_address'] + '" data-ip_address="' + data['ip_address'] + '" data-floor="' + data['floor'] + '" \
                data-status="' + data['status'] + '"><i class="fa fa-edit"></i>Edit</button>\
                <button type="submit" name="delete_room" class="btn btn-danger" data-id="' + data['room_id'] + '"><i class="fa fa-trash"></i>Delete</button>';
            },
            className : 'text-center',              // จัดให้ข้อมูลอยู่ตรงกลาง
          }
        ],
        serverSide: true,   // เปิดการรับ - ส่งข้อมูลของตาราง
        ajaxSource: '/Search',   // path สำหรับการรับ - ส่งข้อมูล (service)
        serverData: function(sSource, aaData, fnCallback, oSettings) { // สร้าง function สำหรับการรับ - ส่งข้อมูล
            //aaData.push({ "name": "search", "value": aaSearch});     // กำหนดข้อมูลที่จะค้นหา
            oSettings.jqXHR = $.ajax({  // รับ - ส่งข้อมูลโดยใช้ ajax
                dataType: 'json',       // กำหนดรูปแบบข้อมูลเป็น json
                type: "POST",           // กำหนดประเภทการส่งแบบ POST
                url: sSource,           // path สำหรับการรับ - ส่งข้อมูล (ajaxSource)
                data: aaData,           // ข้อมูลที่ส่ง 
                success: function (response) {  // ถ้าติดต่อสำเร็จ
                   if(response === undefined){
                    response = {"aaData":[], "iTotalRecords": 0, "iTotalDisplayRecords": 0};    // จัดเรียงข้อมูลที่ได้รับใหม่ --> -->

                   }else{
                    response = {"aaData": response, "iTotalRecords": response.length, "iTotalDisplayRecords": response.length}; // จัดเรียงข้อมูลที่ได้รับใหม่
                     
                   }

                    fnCallback(response);   // นำข้อมูลกลับขึ้นไป loop ใน columns
                }
            });
        }
      })
      return {
          init: function(){

          },
          onSubmitAddRoom:  function(){
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.querySelectorAll('.needs-validation')
          
            // Loop over them and prevent submission
            Array.prototype.slice.call(forms)
              .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                  if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                  }
          
                  form.classList.add('was-validated')
                }, false)
              })
          },
          switchEvent : function(){
            $('#allon-switch').on('click',function(e){
              console.log($('#switch-box').val());
            })
          }
      }
  })();

  jQuery(document).ready(function(){
      Feature.onSubmitAddRoom();
      Feature.switchEvent();
  });


  /* function clickApiOn() {
    document.getElementById('switch-trigger').switchButton('on');
  }
  function clickApiOff() {
    document.getElementById('switch-trigger').switchButton('off');
  } */
  

</script>

